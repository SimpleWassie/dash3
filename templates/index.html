<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Flask WebSocket App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>
<body>
    <h1>Flask WebSocket App</h1>
    <div>
        <label for="api-url">API URL:</label>
        <input type="text" id="api-url">
        <button id="query-api">Query API</button>
    </div>
    <div>
        <label for="message">WebSocket Message:</label>
        <input type="text" id="message">
        <button id="send-message">Send Message</button>
    </div>
    <div>
        <h2>API Response</h2>
        <table id="api-result" border="1">
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div>
        <h2>WebSocket Response</h2>
        <p id="ws-response"></p>
    </div>

    <script>
        $(document).ready(function() {
            var socket = io();

            socket.on('response', function(data) {
                $('#ws-response').text(data.data);
            });

            $('#query-api').click(function() {
                var apiUrl = $('#api-url').val();
                $.get('/api_query', { url: apiUrl }, function(data) {
                    var tbody = $('#api-result tbody');
                    tbody.empty();
                    $.each(data, function(key, value) {
                        tbody.append('<tr><td>' + key + '</td><td>' + value + '</td></tr>');
                    });
                });
            });

            $('#send-message').click(function() {
                var message = $('#message').val();
                socket.emit('custom_event', { data: message });
            });
        });
    </script>
</body>
</html>
